# Release Notes: v0.1.6-a.1

**Release Date**: 2025-10-09
**Release Tag**: v0.1.6-a.1
**Feature**: CSV Import Safety & Accessibility Hardening

---

## Summary

Production-ready hardening of the `/import` CSV upload page with comprehensive safety guards, real calendar validation, and WCAG 2.2 accessibility compliance. This release adds robust pre-parse checks, delimiter detection, and privacy-preserving error handling while maintaining zero network calls during CSV processing.

---

## What Changed

### Safety Guards
- **File size limit**: 1MB maximum (prevents browser freezing)
- **Row count limit**: 1000 non-empty rows (protects against memory exhaustion)
- **Delimiter detection**: Comma-only CSV parsing (rejects semicolons with clear error)
- **Real calendar validation**: Luxon DateTime catches impossible dates (e.g., 2025-02-30, 2025-13-45)
- **UTF-8 BOM handling**: Strips byte order mark for Windows exports
- **CRLF support**: Windows-friendly line splitting (`/\r?\n/`)
- **Field trimming**: Per-field whitespace removal
- **Stale results clearing**: Previous results removed when errors occur

### Accessibility (WCAG 2.2 Level A/AA)
- **Label association**: File input has explicit `<label for="csv-file-input">`
- **Error announcements**: Error region with `role="alert" aria-live="polite"`
- **Table semantics**: Results table includes `<caption>` for screen readers

### Security
- **XSS/formula injection**: CSV formulas (=, +, -, @) safely rendered as plain text via React 18+ auto-escaping
- **Zero network calls**: CSV processing happens entirely client-side (privacy-first)

### Error Messages (Locked Copy)
- `"CSV too large (max 1MB)"` â†’ E-001
- `"Too many rows (max 1000)"` â†’ E-002
- `"Parse failure: expected comma-delimited CSV"` â†’ E-003
- `"Invalid CSV headers. Expected: provider,amount,currency,dueISO,autopay"` â†’ E-004
- `"Invalid date in row X: YYYY-MM-DD"` â†’ E-007

---

## Verification Steps

### Manual Fast Checks (All Passed in Production)

1. **Valid CSV happy path**:
   - Upload 3-5 row CSV with real dates (YYYY-MM-DD)
   - âœ… Schedule renders with confidence/risk pills
   - âœ… "Download .ics" button works

2. **Oversize file**:
   - Upload file >1MB
   - âœ… Error: "CSV too large (max 1MB)"
   - âœ… Page stays usable

3. **>1000 rows**:
   - Upload CSV with 1001 non-empty rows
   - âœ… Error: "Too many rows (max 1000)"

4. **Wrong delimiter**:
   - Upload semicolon-delimited CSV
   - âœ… Error: "Parse failure: expected comma-delimited CSV"

5. **Invalid date format**:
   - Upload CSV with `2025-13-45`
   - âœ… Error: "Invalid date in row 1: 2025-13-45"

6. **Invalid real date**:
   - Upload CSV with `2025-02-30`
   - âœ… Error: "Invalid date in row 1: 2025-02-30"

7. **Accessibility**:
   - âœ… File input has label
   - âœ… Error region has `role="alert" aria-live="polite"`
   - âœ… Table has caption

8. **Network isolation**:
   - âœ… Zero network requests during CSV processing

### Automated Tests
- 21/21 integration tests passing
- Coverage: file size, row counts, delimiter detection, date validation, a11y attributes, button types, network isolation, XSS/formula safety

---

## Constitution Checklist

- âœ… **Files touched**: 2 (frontend/src/pages/Import.tsx, tests) â€” under â‰¤4 limit
- âœ… **LOC delta**: +31 â€” under â‰¤90 target (cap â‰¤140)
- âœ… **Dependencies**: 0 new (uses existing Luxon)
- âœ… **Reversible**: Single revert capability (`git revert f670d03`)
- âœ… **Privacy**: Zero network calls during CSV processing

---

## Rollback Procedure

If issues arise, revert with:

```bash
git revert f670d03
git push origin main
```

This will restore the previous `/import` page behavior while keeping all other features intact.

---

## Observability Notes

Watch for locked error copy occurrences in console/monitoring to confirm users receive clear feedback:

- `"CSV too large (max 1MB)"` â†’ File size guard triggered
- `"Too many rows (max 1000)"` â†’ Row count guard triggered
- `"Parse failure: expected comma-delimited CSV"` â†’ Delimiter detection triggered
- `"Invalid date in row X: YYYY-MM-DD"` â†’ Real calendar validation triggered

**Privacy note**: No PII logged; error strings are static and contain no user data.

---

## Related Issues

- **Implemented**: MMT-9 (CSV Import Safety), MMT-10 (A11y Hardening)
- **Future**: MMT-11 (Currency regex validation, Clear button) â€” Backlog

---

## Credits

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
