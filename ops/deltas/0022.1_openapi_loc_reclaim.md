# 0022.1: OpenAPI v1 — LOC Compression

**Date:** 2025-10-08
**Type:** Docs-only (flow-style YAML compression)
**Parent:** 0022 (OpenAPI v1 for POST /api/plan)

## Summary

Whitespace/format-only flow-style compression of `api/openapi.yaml`. Reclaimed 7 lines (180 → 173 LOC) by converting block-style YAML to flow-style for `tags`, `servers`, and POST `description`. No semantic drift: schemas, enums, headers, examples, and all required phrases unchanged. Spectral validation remains clean (0 errors, 0 warnings).

## Scope

**Docs-only**: `api/openapi.yaml` already at 173 LOC; Spectral 0/0 retained.

**Files modified**: 1 (api/openapi.yaml)

## What Changed

### Before (180 LOC)
- Global `tags` definition: 3 lines (block style)
- `servers` array: 3 lines (block style)
- POST operation `description`: 4 lines (block style with `>` folded scalar)

### After (173 LOC)
- Global `tags` definition: 1 line (flow style)
- `servers` array: 1 line (flow style)
- POST operation `description`: 1 line (single-line compact)

### Total Saved
**−7 lines** (180 → 173)

## Verification

```bash
# LOC count
wc -l api/openapi.yaml
# Expected: 173 api/openapi.yaml

# Spectral validation
npx -y @stoplight/spectral-cli lint api/openapi.yaml
# Expected: No results with a severity of 'error' found!

# Required phrases present (Constitution)
grep -n "60 requests/hour per IP (Upstash)" api/openapi.yaml
# Expected: Match on line 13

grep -n "clients typically call relative path" api/openapi.yaml
# Expected: Matches on lines 8 and 13
```

## Risk

**None** - Pure whitespace/formatting compression. No runtime impact, no semantic changes.

## Rollback

```bash
git revert <merge-commit-sha>
```

## Metrics

| Metric | Before | After | Delta |
|--------|--------|-------|-------|
| LOC | 180 | 173 | −7 |
| Spectral Errors | 0 | 0 | 0 |
| Spectral Warnings | 0 | 0 | 0 |
| Schemas | 7 | 7 | 0 |
| Response Codes | 4 | 4 | 0 |

## Appendix: Diff Excerpt

```diff
-tags:
-  - name: plan
-    description: Payment planning operations
+tags: [{ name: plan, description: Payment planning operations }]

-servers:
-  - url: https://api.example.com
-    description: Informational placeholder only; clients typically call relative path.
+servers: [{ url: "https://api.example.com", description: "Illustrative; clients typically call relative path" }]

-      description: >
-        Processes a client-provided items array and returns a normalized plan with risk flags and metadata.
-        Rate limit: 60 requests/hour per IP (Upstash). The server URL in this spec is illustrative;
-        typical clients call a relative path when deployed on Vercel edge/serverless.
+      description: Processes items array, returns plan with risk flags and metadata. Rate limit 60 requests/hour per IP (Upstash). Clients typically call relative path.
```
