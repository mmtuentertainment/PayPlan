# Quickstart: Manual Testing for CSV Export

**Feature**: CSV Export (014-build-a-csv)
**Date**: 2025-10-14
**Purpose**: Manual test scenarios for validating CSV export functionality

## Prerequisites

1. PayPlan development server running (`npm run dev` in `frontend/`)
2. Test data prepared (see Test Data Sets below)
3. Spreadsheet software installed (Excel, Google Sheets, or LibreOffice)
4. Browser DevTools open (Console + Network tabs)

## Test Data Sets

### Dataset 1: Basic Payments (Happy Path)
**Purpose**: Verify standard export with full data

```csv
provider,installment_no,due_date,amount,currency,autopay,late_fee
Klarna,1,2025-10-14,45.00,USD,true,7
Afterpay,2,2025-10-21,32.50,USD,false,8
Affirm,1,2025-10-28,58.00,USD,true,10
```

**Expected Risk Data**: Auto-generated by PayPlan's risk detection

### Dataset 2: Empty Risk Data
**Purpose**: Verify FR-010 (empty strings for missing risk data)

```csv
provider,installment_no,due_date,amount,currency,autopay,late_fee
Klarna,1,2025-12-01,25.00,USD,false,5
```

**Setup**: Import on a date with no collisions, no weekend autopay, no cash crunch

**Expected**: `risk_type`, `risk_severity`, `risk_message` columns all contain empty strings (`""`)

### Dataset 3: Special Characters
**Purpose**: Verify FR-006 (RFC 4180 escaping)

```csv
provider,installment_no,due_date,amount,currency,autopay,late_fee
"Klarna, Inc.",1,2025-10-14,45.00,USD,true,7
"Bob's ""Best"" Buy",1,2025-10-15,30.00,USD,false,5
"Multi
Line
Provider",1,2025-10-16,20.00,USD,true,0
```

**Expected**: All special characters properly escaped in export

### Dataset 4: Unicode Characters
**Purpose**: Verify FR-009 (preserve non-ASCII characters)

```csv
provider,installment_no,due_date,amount,currency,autopay,late_fee
Café Münchën,1,2025-10-14,€45.00,EUR,true,€7
東京ストア,1,2025-10-15,¥5000,JPY,false,¥500
```

**Expected**: Currency symbols and accented characters preserved in export

### Dataset 5: Large Dataset (600 Records)
**Purpose**: Verify FR-012 (performance warning at 500+ records)

**Setup**: Use PayPlan's "Generate Test Data" feature or import via script

**Expected**:
- Warning message: "Generating large export (600 records). This may take a moment..."
- Export completes in <3 seconds
- CSV file downloads successfully

## Manual Test Scenarios

### Scenario 1: Basic CSV Export

**Steps**:
1. Navigate to PayPlan Import page
2. Upload Dataset 1 (Basic Payments)
3. Click "Build Plan"
4. Verify "Download CSV" button appears next to "Download .ics"
5. Click "Download CSV"
6. Verify file downloads with name `payplan-export-YYYY-MM-DD-HHMMSS.csv`
7. Open CSV in spreadsheet software

**Expected Results**:
- ✅ Filename includes current timestamp
- ✅ CSV has 8 columns: `provider, amount, currency, dueISO, autopay, risk_type, risk_severity, risk_message`
- ✅ 3 data rows (plus header row)
- ✅ All data correctly formatted
- ✅ Risk columns populated (not empty)

**Pass Criteria**: All checkboxes above pass

---

### Scenario 2: Empty Risk Data Handling

**Steps**:
1. Import Dataset 2 (Empty Risk Data)
2. Build plan
3. Export CSV
4. Open in text editor (to see raw values)

**Expected Results**:
- ✅ Risk columns exist in header
- ✅ Risk column values are empty strings (not `null`, `undefined`, or `N/A`)
- ✅ CSV is valid RFC 4180 (no parsing errors)

**Verification Command** (in text editor):
```
Header: provider,amount,currency,dueISO,autopay,risk_type,risk_severity,risk_message
Row 1:  Klarna,25.00,USD,2025-12-01,false,,,
```

The three trailing commas indicate empty risk fields.

**Pass Criteria**: All checkboxes above pass

---

### Scenario 3: Special Character Escaping

**Steps**:
1. Import Dataset 3 (Special Characters)
2. Build plan
3. Export CSV
4. Open in Excel/Google Sheets
5. Verify provider names display correctly

**Expected Results**:
- ✅ Row 1: `Klarna, Inc.` (comma preserved)
- ✅ Row 2: `Bob's "Best" Buy` (quotes preserved)
- ✅ Row 3: `Multi Line Provider` (newlines replaced with spaces or preserved)
- ✅ No parsing errors in spreadsheet

**Raw CSV Inspection** (should show proper quoting):
```
"Klarna, Inc.",45.00,USD,2025-10-14,true,...
"Bob's ""Best"" Buy",30.00,USD,2025-10-15,false,...
"Multi
Line
Provider",20.00,USD,2025-10-16,true,...
```

**Pass Criteria**: All checkboxes above pass

---

### Scenario 4: Unicode Character Preservation

**Steps**:
1. Import Dataset 4 (Unicode Characters)
2. Build plan
3. Export CSV
4. Open in Excel (verify UTF-8 encoding)

**Expected Results**:
- ✅ Row 1: `Café Münchën` (accents preserved)
- ✅ Row 2: `東京ストア` (Japanese characters preserved)
- ✅ Currency symbols: `€`, `¥` display correctly

**Note**: If Excel shows garbled text, verify:
- CSV uses UTF-8 encoding with BOM
- Excel's import settings set to UTF-8

**Pass Criteria**: All checkboxes above pass

---

### Scenario 5: Large Dataset Warning

**Steps**:
1. Generate or import 600 payment records
2. Build plan
3. Click "Download CSV"
4. Observe warning message
5. Proceed with export
6. Measure time to download

**Expected Results**:
- ✅ Warning appears before export starts
- ✅ Warning message: "Generating large export (600 records). This may take a moment..."
- ✅ User can cancel or proceed
- ✅ Export completes in <3 seconds
- ✅ CSV file downloads successfully
- ✅ All 600 records present in CSV

**Performance Check**:
- Open browser DevTools > Performance tab
- Start recording
- Click "Download CSV"
- Stop recording when download starts
- Verify no UI freezes >1 second

**Pass Criteria**: All checkboxes above pass

---

### Scenario 6: Round-trip Compatibility

**Steps**:
1. Import Dataset 1 (Basic Payments)
2. Build plan
3. Export CSV
4. **Re-import** the exported CSV into PayPlan
5. Build plan again
6. Compare results

**Expected Results**:
- ✅ Re-import succeeds without errors
- ✅ All payment data matches original (provider, amount, currency, date, autopay)
- ✅ Risk data matches original (type, severity, message)
- ✅ No data loss or corruption

**Verification**:
```typescript
// Console test
const original = /* first import result */;
const roundtrip = /* re-import result */;
console.log(JSON.stringify(original) === JSON.stringify(roundtrip)); // Should be true
```

**Pass Criteria**: All checkboxes above pass

---

### Scenario 7: Button State Management

**Steps**:
1. Navigate to PayPlan Import page (no data loaded)
2. Verify "Download CSV" button state
3. Import payments and build plan
4. Verify button becomes enabled
5. Clear data
6. Verify button becomes disabled again

**Expected Results**:
- ✅ Button hidden/disabled when no payments processed
- ✅ Button visible/enabled when payments exist
- ✅ Button positioned next to "Download .ics" button
- ✅ Button has clear label "Download CSV"

**Visual Check**:
- Buttons aligned horizontally
- Consistent spacing with .ics button
- Accessible via keyboard (Tab navigation)

**Pass Criteria**: All checkboxes above pass

---

### Scenario 8: Filename Timestamp Accuracy

**Steps**:
1. Note current time (e.g., 14:30:52 on 2025-10-14)
2. Import payments and build plan
3. Click "Download CSV" at exactly 14:30:52
4. Check downloaded filename

**Expected Results**:
- ✅ Filename: `payplan-export-2025-10-14-143052.csv`
- ✅ Timestamp matches click time (within 1-2 seconds)
- ✅ Filename is cross-platform safe (no invalid characters)

**Cross-platform Test**:
- Windows: Save to Desktop, verify no errors
- macOS: Save to Downloads, verify no errors
- Linux: Save to ~/Downloads, verify no errors

**Pass Criteria**: All checkboxes above pass

---

### Scenario 9: Browser Compatibility

**Browsers to Test**:
1. Chrome 90+
2. Firefox 88+
3. Safari 14+
4. Edge 90+

**Steps** (repeat for each browser):
1. Import Dataset 1
2. Build plan
3. Export CSV
4. Verify download behavior

**Expected Results** (per browser):
- ✅ Download triggers without errors
- ✅ File saves to default download location
- ✅ CSV opens correctly in spreadsheet software
- ✅ No console errors

**Pass Criteria**: All browsers pass all checkboxes

---

### Scenario 10: Edge Cases

#### 10a: Zero Payments
**Steps**:
1. Clear all data
2. Check if "Download CSV" button appears

**Expected**: Button hidden/disabled (per FR-001)

#### 10b: Single Payment
**Steps**:
1. Import single payment
2. Export CSV

**Expected**:
- ✅ CSV has header + 1 data row
- ✅ Proper formatting

#### 10c: Exactly 500 Records
**Steps**:
1. Import 500 records
2. Export CSV

**Expected**:
- ✅ No warning (threshold is >500, not ≥500)
- ✅ Export completes quickly

#### 10d: 1000+ Records
**Steps**:
1. Import 1200 records
2. Attempt export

**Expected**:
- ✅ Warning appears
- ✅ Export still works (may be slower)
- ✅ All 1200 records in CSV

**Pass Criteria**: All edge cases pass

## Regression Tests

### Regression 1: .ics Download Still Works

**Steps**:
1. Import payments
2. Build plan
3. Click "Download .ics" (not CSV)

**Expected**:
- ✅ .ics file downloads correctly
- ✅ No interference from CSV feature

### Regression 2: Copy Plan Still Works

**Steps**:
1. Import payments
2. Build plan
3. Click "Copy Plan"

**Expected**:
- ✅ Text copied to clipboard
- ✅ No interference from CSV feature

**Pass Criteria**: Both regression tests pass

## Accessibility Tests

### A11y Test 1: Keyboard Navigation

**Steps**:
1. Tab through Results page
2. Focus reaches "Download CSV" button
3. Press Enter or Space

**Expected**:
- ✅ Button receives focus (visible focus ring)
- ✅ Enter key triggers download
- ✅ Space key triggers download

### A11y Test 2: Screen Reader Compatibility

**Screen Readers**: NVDA (Windows), VoiceOver (macOS)

**Steps**:
1. Enable screen reader
2. Navigate to Results page
3. Listen to button announcement

**Expected**:
- ✅ Button announced as "Download CSV button"
- ✅ Warning message read aloud (for 500+ records)
- ✅ No unlabeled elements

**Pass Criteria**: All A11y tests pass

## Performance Benchmarks

| Record Count | Expected Time | Actual Time | Pass/Fail |
|--------------|---------------|-------------|-----------|
| 10           | <50ms         | _____       | _____     |
| 50           | <100ms        | _____       | _____     |
| 100          | <150ms        | _____       | _____     |
| 500          | <500ms        | _____       | _____     |
| 1000         | <1000ms       | _____       | _____     |

**Measurement Method**:
1. Open DevTools > Console
2. Run: `console.time('csv-export')`
3. Click "Download CSV"
4. Run: `console.timeEnd('csv-export')`

## Common Issues & Troubleshooting

### Issue: Excel Shows Garbled Unicode
**Solution**: Ensure CSV uses UTF-8 with BOM. Update PapaParse config to include BOM.

### Issue: Special Characters Not Escaped
**Solution**: Verify `quotes: true` in PapaParse config.

### Issue: File Downloads with Wrong Name
**Solution**: Check timestamp generation logic, verify no timezone issues.

### Issue: Large Exports Freeze Browser
**Solution**: Reduce test dataset or verify warning appears at 500+ records.

## Sign-off Checklist

- [ ] All 10 manual test scenarios pass
- [ ] All edge cases handled correctly
- [ ] Regression tests pass (.ics and Copy Plan unaffected)
- [ ] Accessibility tests pass (keyboard + screen reader)
- [ ] Performance benchmarks met
- [ ] Cross-browser compatibility confirmed (Chrome, Firefox, Safari, Edge)
- [ ] Round-trip import verified (zero data loss)

**Tested By**: _________________
**Date**: _________________
**Notes**: _________________
